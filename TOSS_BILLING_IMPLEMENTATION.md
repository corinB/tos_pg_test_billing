# ğŸ“˜ Spring Boot í† ìŠ¤í˜ì´ë¨¼ì¸  ì •ê¸°ê²°ì œ(Billing) êµ¬í˜„ ëª…ì„¸ì„œ

ë³¸ ë¬¸ì„œëŠ” Spring Boot í™˜ê²½ì—ì„œ í† ìŠ¤í˜ì´ë¨¼ì¸ ì˜ **ìë™ê²°ì œ(Billing)** ì‹œìŠ¤í…œì„ êµ¬ì¶•í•œ êµ¬í˜„ ë‚´ì—­ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

---

## 1. ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ & ê¸°ìˆ  ìŠ¤íƒ

*   **Language**: Java 21
*   **Framework**: Spring Boot 3.5.9
*   **Database**: MySQL (JPA/Hibernate)
*   **Payment Gateway**: Toss Payments (Billing API)
*   **Frontend**: Thymeleaf (ì¹´ë“œ ë“±ë¡ìš©), Toss Payments SDK

---

## 2. ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ë§ (ERD)

í•µì‹¬ ì—”í‹°í‹°ëŠ” **Member(ìœ ì €)**, **Billing(ì¹´ë“œì •ë³´)**, **PaymentHistory(ê²°ì œì´ë ¥)** 3ê°€ì§€ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

### 2-1. Member (íšŒì›)
ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ì…ë‹ˆë‹¤.
*   `id` (PK): ë‚´ë¶€ ê´€ë¦¬ìš© ID
*   `email`, `name`: ì‚¬ìš©ì ì •ë³´
*   `customerKey`: **ì¤‘ìš”** í† ìŠ¤í˜ì´ë¨¼ì¸ ì™€ ì—°ë™ë˜ëŠ” ìœ ì € ê³ ìœ  ì‹ë³„ì (UUID ê¸°ë°˜ ìƒì„±)

### 2-2. Billing (ë¹Œë§ ì •ë³´)
ì‚¬ìš©ìê°€ ë“±ë¡í•œ ì¹´ë“œ ì •ë³´(í† í°)ì…ë‹ˆë‹¤. ì‹¤ì œ ì¹´ë“œë²ˆí˜¸ëŠ” ì €ì¥í•˜ì§€ ì•Šê³  `billingKey`ë§Œ ì €ì¥í•©ë‹ˆë‹¤.
*   `customerKey` (FK): ì–´ë–¤ ìœ ì €ì˜ ì¹´ë“œì¸ì§€ ì‹ë³„
*   `billingKey`: **ì¤‘ìš”** ê²°ì œ ìŠ¹ì¸ ì‹œ ì‚¬ìš©í•˜ëŠ” ì•”í˜¸í™”ëœ í‚¤
*   `cardCompany`, `cardNumber`: ë§ˆìŠ¤í‚¹ëœ ì •ë³´ (í™”ë©´ í‘œì‹œìš©)

### 2-3. PaymentHistory (ê²°ì œ ì´ë ¥)
ê²°ì œ ìŠ¹ì¸ ë‚´ì—­ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
*   `orderId`: ì£¼ë¬¸ ê³ ìœ  ë²ˆí˜¸ (UUID)
*   `amount`: ê²°ì œ ê¸ˆì•¡
*   `status`: ê²°ì œ ìƒíƒœ (DONE, CANCELED ë“±)
*   `paymentKey`: í† ìŠ¤ ê±°ë˜ ê³ ìœ  í‚¤ (í™˜ë¶ˆ ì‹œ í•„ìš”)

---

## 3. ğŸ”„ í•µì‹¬ ê²°ì œ í”„ë¡œì„¸ìŠ¤ (Logic Flow)

### Step 1. ì¹´ë“œ ë“±ë¡ (Frontend -> Toss -> Backend)
1.  **Frontend**: `TossPayments.requestBillingAuth('ì¹´ë“œ', ...)` í˜¸ì¶œ
2.  **User**: ê²°ì œì°½ì—ì„œ ì¹´ë“œ ì •ë³´ ì…ë ¥ ë° ë³¸ì¸ì¸ì¦
3.  **Toss**: ì„±ê³µ ì‹œ `authKey`ë¥¼ ë‹´ì•„ Redirect URL í˜¸ì¶œ
4.  **Backend**:
    *   `authKey`ë¥¼ ë°›ì•„ í† ìŠ¤ API (`/v1/billing/authorizations/issue`) í˜¸ì¶œ
    *   ì‘ë‹µë°›ì€ `billingKey`ë¥¼ **Billing ì—”í‹°í‹°ì— ì €ì¥**

### Step 2. ì •ê¸° ê²°ì œ ìŠ¹ì¸ (Backend Only)
1.  **Request**: íŠ¹ì • ìœ ì €(Member ID)ì— ëŒ€í•œ ê²°ì œ ìš”ì²­
2.  **Service**:
    *   DBì—ì„œ ìœ ì €ì˜ `billingKey` ì¡°íšŒ
    *   í† ìŠ¤ API (`/v1/billing/{billingKey}`) í˜¸ì¶œí•˜ì—¬ ê²°ì œ ìŠ¹ì¸ ìš”ì²­
3.  **Result**: ì„±ê³µ ì‹œ **PaymentHistory ì—”í‹°í‹°ì— ê¸°ë¡** ì €ì¥

---

## 4. ğŸ“¡ API ëª…ì„¸ì„œ (API Specification)

ëª¨ë“  APIëŠ” `/api/v1/billing` ê²½ë¡œë¥¼ ê°€ì§‘ë‹ˆë‹¤.

| Method | URI | ì„¤ëª… | Request Body / Param |
| :--- | :--- | :--- | :--- |
| `POST` | `/signup` | íšŒì›ê°€ì… (í…ŒìŠ¤íŠ¸ìš©) | `{ "email": "...", "name": "..." }` |
| `POST` | `/pay/member/{id}` | **100ì› ê²°ì œ ìš”ì²­** | PathVariable: `memberId` |
| `GET` | `/history/member/{id}`| ê²°ì œ ì´ë ¥ ì¡°íšŒ | PathVariable: `memberId` |
| `DELETE`| `/member/{id}` | ì¹´ë“œ ì •ë³´(ë¹Œë§í‚¤) ì‚­ì œ | PathVariable: `memberId` |

> **ì°¸ê³ **: ì¹´ë“œ ë“±ë¡ì€ APIê°€ ì•„ë‹Œ ì›¹ í˜ì´ì§€(`GET /?customerKey=...`)ë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

---

## 5. ğŸ’» ì£¼ìš” ì½”ë“œ ìŠ¤ë‹ˆí«

### 5-1. Service: í† ìŠ¤ API í˜¸ì¶œ (RestClient)
`RestClient`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°„ê²°í•˜ê²Œ ì™¸ë¶€ APIì™€ í†µì‹ í•©ë‹ˆë‹¤.

```java
// TossPaymentService.java

// 1. ë¹Œë§í‚¤ ë°œê¸‰ ìš”ì²­
public BillingKeyResponse issueBillingKey(String authKey, String customerKey) {
    // ... ìš”ì²­ ë°”ë”” êµ¬ì„± ...
    return restClient.post()
            .uri("/billing/authorizations/issue")
            .body(requestBody)
            .retrieve()
            .body(BillingKeyResponse.class);
}

// 2. ê²°ì œ ìŠ¹ì¸ ìš”ì²­
public PaymentResponse payWithBillingKey(...) {
    // ...
    return restClient.post()
            .uri("/billing/" + billingKey)
            .body(requestBody)
            .retrieve()
            .body(PaymentResponse.class);
}
```

### 5-2. Frontend: SDK ì—°ë™
ìœ ì € ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ ê²°ì œì°½ì„ í˜¸ì¶œí•©ë‹ˆë‹¤ (UX ìµœì í™”).

```javascript
// index.html
tossPayments.requestBillingAuth('ì¹´ë“œ', {
    customerKey: customerKey,
    customerEmail: customerEmail, // ë¯¸ë¦¬ ì±„ì›€
    customerName: customerName,   // ë¯¸ë¦¬ ì±„ì›€
    successUrl: window.location.origin + '/success',
    failUrl: window.location.origin + '/fail'
})
```

---

## 6. âš ï¸ ìš´ì˜ ì£¼ì˜ì‚¬í•­

1.  **ìµœì†Œ ê²°ì œ ê¸ˆì•¡**: ì‹ ìš©ì¹´ë“œ ìë™ê²°ì œëŠ” **ìµœì†Œ 100ì›** ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.
2.  **í…ŒìŠ¤íŠ¸ í™˜ê²½**: í˜„ì¬ `test_ck_` í‚¤ë¥¼ ì‚¬ìš© ì¤‘ì´ë¯€ë¡œ ì‹¤ì œ ê³¼ê¸ˆë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìƒìš© ì „í™˜ ì‹œ `live_ck_` í‚¤ë¡œ êµì²´í•´ì•¼ í•©ë‹ˆë‹¤.
3.  **ë³´ì•ˆ**: `billingKey`ëŠ” ìœ ì¶œ ì‹œ í•´ë‹¹ ìœ ì € ì¹´ë“œë¡œ ê²°ì œê°€ ê°€ëŠ¥í•˜ë¯€ë¡œ ë³´ì•ˆì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤. (ë³¸ í”„ë¡œì íŠ¸ëŠ” DBì— í‰ë¬¸ ì €ì¥ ì¤‘ì´ë¯€ë¡œ, ì‹¤ì œ ìš´ì˜ ì‹œ ì•”í˜¸í™” ê¶Œì¥)

---
*Generated by Gemini Agent*
